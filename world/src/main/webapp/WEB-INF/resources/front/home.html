<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">

<title>é¦–é¡µ</title>
<style type="text/css">
    body{background-color: rgba(255, 235, 59, 0.08);}
	.page_head{width:100%;height:100%;display:block;}
	.page_show{width:100%;height:100%;display:block;}
	.page_hide{display: none;}
	.page_table{border:solid #add9c0; border-width:1px 0px 0px 1px;}	
	.page_table tr{width: 100%;height: 40px;}
	.page_table tr td{width: 33%;background-color: pink;}
	.page_div_right{width:70%;height: 50%;background-color: green;position: relative;float: right;}
	.page_div_left{width:30%;height: 50%;position: relative;float: left;}
	
</style>
<script src="../common/js/jquery.min.js"></script>
</head>
<body>
	<div class="page_head">
		<img alt="" src="../images/IMG_3803.jpg" width="100%" id="u_img">
	</div>
	<div id="user_info">
		<!-- <p>ç‰›ä¸»ï¼šæ¼”æ’­</p>
		<p>IDï¼š1å·</p>
		<p>æ‰‹æœºå·ï¼š15172117256</p>
		<p>ä¸­å¥–å·ç ï¼š0001ï¼Œ0002ï¼Œ0003ï¼Œ0923</p> -->
	</div>
	<!-- <div class="page_show" id="show_info">
		<div class="page_div_right">
			<table class="page_table">
				<tr><td>èŠ‚ç›®åç§°</td><td>æ¼”å‡ºäººå‘˜</td><td>å¾—åˆ†</td></tr>
				<tr><td>æ—¶å…‰å‰ªå½±</td><td>æ–‡èˆ’ã€æœ±è¯šäº¦</td><td>20</td></tr>
			</table>
		</div>
		<div class="page_div_left">
			<img alt="" src="../images/IMG_3808.jpg" width="100%"/>
		</div>
	</div>
	<div class="page_show" id="show_info2">
		<div class="page_div_right">
			<table class="page_table">
				<tr><td>èŠ‚ç›®åç§°</td><td>æ¼”å‡ºäººå‘˜</td><td>å¾—åˆ†</td></tr>
				<tr><td>æ—¶å…‰å‰ªå½±</td><td>æ–‡èˆ’ã€æœ±è¯šäº¦</td><td>20</td></tr>
			</table>
		</div>
		<div class="page_div_left">
			<img alt="" src="../images/IMG_3808.jpg" width="100%"/>
		</div>
	</div> -->
	<p id="click_count">å“ˆå“ˆ</p>
	<button onclick="start()">å¼€å§‹GO</button>
</body>
<script type="text/javascript">
	var basepath="/world";//é¡¹ç›®å
	var serial=1;//åˆå§‹åŒ–è·å–ç¬¬ä¸€ä¸ªèŠ‚ç›®ä¿¡æ¯
	$(function(){
		getResource("GET",basepath+"/front/home/userinfo",{},0);	
		getResource("GET",basepath+"/front/home/showinfo/"+serial,{},1);
	})
	
	function getResource(type,url,data,state){
		$.ajax({
			type:type,
			url:url,
			data:data,
			dataType:"json",
			success:function(resp){
				if(state==0) userinfo(resp);
				else if(state==1) showinfo(resp);
				else if(state==2) checkStatus(resp);
			},
			error:function(){
				alert("Server error!");
			}
		})
	}
	
	function userinfo(resp){
		console.log(resp);
		if(resp.code=="0"){
			var user=eval("("+decodeURIComponent(resp.message)+")");
			console.log(user);
			$("#u_img").attr("src",user.img);
			$("#user_info").append("<p>ç‰›ä¸»ğŸ‚ï¼š"+user.username+"</p><p>ID:"+user.id+"</p><p>æ‰‹æœºå·:"+user.tel+"</p><p>ä¸­å¥–å·ç :"+user.serialnumbers+"</p><p></p>")
		}else{
			$("#user_info").append("<p>"+resp.message+"</p>")
		}
	}
	//æŸ¥è¯¢æ­£åœ¨è¿›è¡Œçš„èŠ‚ç›®æµç¨‹çš„åºå·ï¼Œç„¶åæ ¹æ®è¿™ä¸ªåºå·æŸ¥è¯¢å‡ºå‰é¢çš„æ‰€æœ‰çš„èŠ‚ç›®
	//æŸ¥è¯¢æŠ•ç¥¨è¡¨ï¼ŒæŸ¥è¯¢å‡ºå·²ç»æŠ•ç¥¨äº†çš„è®°å½•
	//æœ‰ä¸€ä¸ªæŠ•ç¥¨çŠ¶æ€
	function showinfo(resp){
		console.log(resp);
		if(resp.code=="0"){
			var show=eval("("+decodeURIComponent(resp.message)+")");
			console.log(show);
			$("body").append("<div class=\"page_show\" id=\"show_info\"><div class=\"page_div_right\">\
					<table class=\"page_table\">\
						<tr><td>èŠ‚ç›®åç§°</td><td>æ¼”å‡ºäººå‘˜</td><td>å¾—åˆ†</td></tr>\
						<tr><td>"+show.name+"</td><td>"+show.performers+"</td><td>å›¾ç‰‡</td></tr>\
					</table>\
				</div>\
				<div class=\"page_div_left\"><img src=\"../images/IMG_3808.jpg\" width=\"100%\"/></div></div>");
		}
	}

	
	
	//ç‚¹å‡»äº‹ä»¶åªèƒ½ä¸€æ¬¡æ€§æäº¤ï¼šç‚¹å‡»å¼€å§‹ï¼Œç„¶å1åˆ†é’Ÿè®¡æ—¶å¼€å§‹
	var seconds=60;
	var click=0;
	//ç‚¹å‡»å¼€å§‹
	function start(){
		//ç‚¹å‡»å¼€å§‹ç„¶åç›´æ¥è¯·æ±‚æ¥å£ï¼Œå°†å¼€å§‹äº†è¿™ä¸ªä¿¡å·å‘åˆ°åå°ï¼Œè®©åå°ä¹Ÿå¼€å§‹å®šæ—¶ç»Ÿè®¡ï¼Œå…å¾—åˆ«äººåˆ·æ–°é¡µé¢è¿™ç§è¡Œä¸º
		getResource("POST",basepath+"/front/home/click",{},2);
	}
	
	function checkStatus(resp){
		if(resp.code=="1") {
			alert(resp.message);
			return;
		}
		$("body").append("<button onclick=\"doCount()\">å¿«é€Ÿç‚¹å‡»å¬å”¤ç¥é¾™</button>");
		var intervar=setInterval(function(){
			console.log(seconds);
			seconds--;
			if(seconds<0){
				clearInterval(intervar);
				//å‘é€httpè¯·æ±‚å°†ç‚¹å‡»çš„æ¬¡æ•°ä¸Šä¼ 
				getResource("POST",basepath+"/front/home/click",{count:click},3);	
			}
		},1000);
	}
	
	//ç‚¹å‡»è§¦å‘äº‹ä»¶
	function doCount(){
		if(seconds<0) return;//æ—¶é—´ç»“æŸå°±åœæ­¢ç»Ÿè®¡
		click++;
		$("#click_count").text("ç‚¹å‡»äº† "+click+" æ¬¡");
	}
</script>
</html>